terraform {
  required_providers {
    alertops = {
      source  = "alertopsterraform/alertops"
    }
  }
}

provider "alertops" {
  api_key = var.alertops_api_key
}

variable "alertops_api_key" {
  description = "AlertOps API key"
  type        = string
  sensitive   = true
}

# Generate preview of the JSON that will be sent to AlertOps
locals {
  user_request_preview = {
    user_name    = "terraform-simple-test"
    first_name   = "Terraform"
    last_name    = "SimpleTest"
    locale       = "en-US"
    time_zone    = "(UTC-06:00) Central Time (US & Canada)"
    type         = "Standard"
    contact_methods = [
      {
        contact_method_name = "Email-Official"
        email = {
          email_address = "terraform-test@example.com"
        }
        enabled = true
        sequence = 1
      }
    ]
    roles = ["Basic"]
  }
}

# Simple user creation test
resource "alertops_user" "simple_test" {
  user_name  = "terraform-simple-test"
  first_name = "Updated-Terraform"
  last_name  = "UpdatedTest"
  locale     = "en-US"
  time_zone  = "(UTC-06:00) Central Time (US & Canada)"
  type       = "Standard"
  
  contact_methods {
    contact_method_name = "Email-Official"
    email {
      email_address = "terraform-test@example.com"
    }
    enabled = true
    sequence = 1
  }
  
  roles = ["App Admin"]
}

# Output for verification
output "simple_test_user_id" {
  value = alertops_user.simple_test.user_id
}

output "request_json_preview" {
  value = jsonencode(local.user_request_preview)
  description = "Preview of JSON that will be sent to AlertOps API"
} 